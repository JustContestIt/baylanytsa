# Bailanysta

## 1. Краткое описание
Bailanysta — минимально жизнеспособная социальная сеть с лентой постов, профилями, подписками и лайв-уведомлениями. Стек разделён на два слоя: сервер (Express + Prisma + Socket.IO) и клиент (Next.js App Router + Tailwind + SWR). Проект готов к локальному запуску, дальнейшей доработке и деплою.

## 2. Установка и запуск
### Предварительные требования
- Node.js >= 18
- npm >= 9

### Клонирование и подготовка
```bash
git clone <your-fork-url>
cd baylanytsa
```

### Настройка сервера
```bash
cd server
cp .env.example .env
# при необходимости отредактируйте DATABASE_URL, JWT_SECRET, OPENAI_API_KEY, CLIENT_ORIGIN
npm install
npx prisma generate
npx prisma migrate dev
npm run dev
```
Сервер поднимается на `http://localhost:4000` и обслуживает API + Socket.IO.

### Настройка веб-клиента
В новом терминале:
```bash
cd web
cp .env.example .env.local
npm install
npm run dev
```
Интерфейс доступен на `http://localhost:3000`.

### Скрипты
- `npm run dev` — режим разработки (соответствующий слой).
- `npm run build` / `npm run start` — production-сборка.
- `npm run lint` — статический анализ (server: TypeScript, web: ESLint).
- `npx prisma migrate deploy` — применять миграции в проде.

## 3. Процесс проектирования
1. **Архитектура**: выделены два независимых пакета (`server`, `web`) с собственными зависимостями и конфигами. Общение между ними происходит по REST + Socket.IO.
2. **Данные**: схема Prisma покрывает пользователей, посты, лайки, комментарии, подписки и уведомления. Уникальные ограничения предотвращают дублирование лайков и подписок.
3. **Аутентификация**: JWT в HttpOnly cookie. Регистрация идемпотентна: повторный вызов возвращает существующего пользователя и обновляет cookie.
4. **API-слой**: все маршруты типизированы и валидируются через Zod. Заложена пагинация курсором, поиск по контенту и уведомления в реальном времени.
5. **Клиент**: Next.js App Router, компоненты в Tailwind, состояние данных через SWR + ручное обновление кэша после действий. Уведомления слушаются через Socket.IO-клиент.
6. **AI-интеграция**: серверный эндпоинт оборачивает OpenAI Chat Completions с graceful fallback при отсутствии ключа.

## 4. Уникальные подходы и методологии
- **Композиция кэша SWR**: хендлеры лайков/комментариев точечно обновляют страницы без полной перезагрузки.
- **Realtime-уведомления**: модуль Socket.IO хранит пул соединений и рассылает payload с актором и контекстом поста.
- **Гибкая регистрация**: повторный `POST /api/users/register` действует как «вход» без пароля, упрощая UX MVP.
- **AI подсказки**: генерация идей поста доступна из формы создания, логика строго на сервере (требование безопасности).

## 5. Компромиссы
- **Без смены пароля**: для MVP не реализованы полноценные учётные записи с секретами; в проде потребуется пароль или OAuth.
- **SQLite по умолчанию**: лёгкость разработки важнее масштабируемости. Переключение на PostgreSQL предусмотрено переменной `DATABASE_URL`.
- **Простая вёрстка**: Tailwind-компоненты минимальны ради скорости, без дизайн-системы/Storybook.
- **Уведомления без батчей**: каждое событие отправляется индивидуально; при высокой нагрузке стоит добавить очереди/агрегацию.

## 6. Известные баги и ограничения
- **npm audit** на фронтенде сообщает о критической уязвимости в цепочке зависимостей Next/ESLint (upstream). Требуется следить за обновлениями.
- **Socket аутентификация** основана на ID из клиентского состояния, а не на JWT-хэндшейке. Для продакшена стоит внедрить проверку токена в `socket.handshake`.
- **AI-ключ**: при отсутствии `OPENAI_API_KEY` генерируется шаблонная подсказка; реальных вызовов без ключа нет.
- **Пагинация комментариев** ограничена тремя последними; нет отдельной загрузки «старых» комментариев.
- **Нет SSR для ленты**: данные подгружаются на клиенте через SWR.

## 7. Почему выбран стек
- **Next.js 14 + App Router** — современный DX, удобный роутинг и готовность к Vercel.
- **Tailwind CSS** — быстрые итерации UI без ручного CSS.
- **SWR** — лёгкий способ клиентского кеширования и оптимистичных апдейтов.
- **Express + Prisma** — стабильный набор для типизированного API поверх SQLite/PostgreSQL.
- **Socket.IO** — простая реализация realtime-уведомлений без ручного WebSocket-слоя.
- **Zod** — строгая валидация запросов и env.
- **OpenAI SDK** — официальный клиент для AI-интеграции.

## Деплой
### Сервер
1. Настроить Railway/Render/VPS с Node.js 18.
2. Установить переменные окружения (`DATABASE_URL`, `JWT_SECRET`, `CLIENT_ORIGIN`, `OPENAI_API_KEY`, `PORT`).
3. Выполнить `npm install`, `npx prisma migrate deploy`, `npm run build`, `npm run start`.
4. Открыть порт (например, 4000) и убедиться в корректном CORS.

### Веб
1. Vercel/Netlify: настроить переменные `NEXT_PUBLIC_API_URL` и `NEXT_PUBLIC_SOCKET_URL` указывающие на развернутый сервер.
2. Убедиться, что сборка выполняется `npm install` → `npm run build` → `npm run start`.

## Публикация в GitHub
1. Создать удалённый репозиторий и связать:
   ```bash
   git remote add origin git@github.com:<username>/bailanysta.git
   ```
2. Выполнить коммит/пуш:
   ```bash
   git add .
   git commit -m "Initial MVP"
   git push -u origin main
   ```

## Чек-лист требований
- [x] Next.js 14 (App Router) + Tailwind + SWR.
- [x] Express + Prisma + SQLite/PostgreSQL переключатель.
- [x] JWT аутентификация через HttpOnly cookie.
- [x] Лайки, комментарии, подписки, поиск, realtime-уведомления.
- [x] AI-эндпоинт на сервере.
- [x] Маршруты `/feed`, `/profile`, `/notifications`.
- [x] Тёмная/светлая тема с сохранением.
- [x] README с проектной документацией.
